# Инструкция по использованию утилиты `gsync`

## 1. Общее описание и назначение утилиты

`gsync` — это утилита для синхронизации файлов и каталогов между локальными и удалёнными серверами, построенная на основе `rsync`. Основная функция `gsync` — отслеживать изменения в указанной директории и автоматически копировать изменённые файлы в целевую директорию. Утилита поддерживает гибкую настройку через конфигурационный файл и может игнорировать определённые файлы и папки с помощью файлов `.nogsync`, аналогично `.gitignore` в Git.

## 2. Инструкция по установке зависимостей

Для работы `gsync` требуется `rsync`, `inotify-tools` и `awk`. Установите их в зависимости от используемой операционной системы.

### Ubuntu/Debian

```bash
sudo apt update
sudo apt install rsync inotify-tools gawk
```

### CentOS/RHEL

```bash
sudo yum install rsync inotify-tools gawk
```

### Fedora

```bash
sudo dnf install rsync inotify-tools gawk
```

### Arch Linux

```bash
sudo pacman -S rsync inotify-tools gawk
```

### macOS (через Homebrew)

```bash
brew install rsync inotify-tools gawk
```

## 3. Как скачать утилиту из репозитория

Скачайте `gsync` из официального репозитория GitHub и добавьте права на выполнение.

```bash
git clone https://github.com/e-bash/gsync.git
cd gsync
chmod +x gsync
```

Теперь утилита `gsync` готова к использованию.

## 4. Подробное описание конфигурационного файла

Конфигурационный файл содержит настройки для работы `gsync`. По умолчанию, утилита ищет файл конфигурации в домашней директории пользователя (`~/.gsync`) или принимает его в виде параметра командной строки.

### Пример конфигурационного файла

```bash
[OPTIONS]
source="/path/to/source/directory/" # Локальная директория для отслеживания. 
target="user@server:/path/to/target/directory/" # Целевая директория для копирования.
links=true # Сохранение символьных ссылок.
perms=false # Сохранение прав доступа.
times=true # Сохранение времени изменения.
group=false # Сохранение групповой принадлежности.
owner=false # Сохранение владельца.
```

### Инструкция по созданию конфигурационного файла

1. Создайте файл конфигурации в домашней директории:

```bash
nano ~/.gsync
```

2. Добавьте необходимые параметры в файл.

3. Сохраните файл и закройте редактор.

Параметры `source` и `target` обязательны. Остальные параметры являются опциональными и могут быть добавлены по необходимости.

## 5. Описание возможностей использования `.nogsync`

Файлы `.nogsync` позволяют исключить из синхронизации определённые файлы и папки. Эти файлы могут находиться в любом месте внутри отслеживаемой директории.

### Пример файла `.nogsync`

```bash
# Игнорировать папку logs и всё её содержимое
logs/

# Игнорировать все файлы с расширением .tmp
*.tmp

# Игнорировать конкретный файл
secret.txt
```

Файл `.nogsync` игнорирует строки, начинающиеся с `#`, позволяя добавлять комментарии. Исключённые пути могут быть как относительными, так и с использованием масок, например `*.log`.

## 6. Порядок использования

### Разовый запуск из командной строки

Вы можете запустить `gsync` разово из командной строки:

```bash
./gsync --config=/path/to/config
```

**Преимущества**: Простой запуск, подходит для разовых операций.

**Недостатки**: Не подходит для постоянного отслеживания изменений.

### Запуск из командной строки в фоновом режиме

Запуск в фоновом режиме с использованием `&`:

```bash
./gsync --config=/path/to/config &
```

**Преимущества**: Утилита продолжает работать после закрытия терминала.

**Недостатки**: Неудобство управления процессом, возможные проблемы с отслеживанием состояния.

### Запуск в качестве службы

Создание системной службы для постоянного мониторинга:

1. Создайте файл службы:

```bash
sudo nano /etc/systemd/system/gsync.service
```

2. Добавьте следующее содержимое:

```bash
[Unit]
Description=GSync Service
After=network.target

[Service]
ExecStart=/path/to/gsync --config=/path/to/config
Restart=always

[Install]
WantedBy=multi-user.target
```

3. Активируйте и запустите службу:

```bash
sudo systemctl enable gsync
sudo systemctl start gsync
```

**Преимущества**: Автоматический запуск при старте системы, надёжность.

**Недостатки**: Требует прав суперпользователя для настройки.

### Запуск с помощью Supervisor

Установка и настройка Supervisor для управления `gsync`:

1. Установите Supervisor:

   - **Ubuntu/Debian:**

   ```bash
   sudo apt install supervisor
   ```

   - **CentOS/RHEL:**

   ```bash
   sudo yum install supervisor
   ```

2. Создайте конфигурационный файл для `gsync`:

```bash
sudo nano /etc/supervisor/conf.d/gsync.conf
```

3. Добавьте следующее содержимое:

```bash
[program:gsync]
command=/path/to/gsync --config=/path/to/config
autostart=true
autorestart=true
stderr_logfile=/var/log/gsync.err.log
stdout_logfile=/var/log/gsync.out.log
```

4. Перезапустите Supervisor для применения изменений:

```bash
sudo supervisorctl reread
sudo supervisorctl update
sudo supervisorctl start gsync
```

**Преимущества**: Легко управлять процессами, отличное логирование.

**Недостатки**: Может потребовать дополнительной настройки, особенно на нестандартных системах.

## 7. Сравнение способов запуска

- **Разовый запуск**: Подходит для временных задач и тестирования.
- **Запуск в фоновом режиме**: Удобен для коротких задач, но сложно управлять в долгосрочной перспективе.
- **Служба**: Идеально для постоянного мониторинга, подходит для серверов.
- **Supervisor**: Подходит для более сложных сценариев, где требуется контроль и логирование.
