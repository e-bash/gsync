# `gsync` - Утилита для автоматической синхронизации файлов

## 1. Общее описание и назначение утилиты

`gsync` — это утилита на основе `rsync` для автоматической синхронизации файлов и каталогов между локальной и удаленной системами. Она позволяет отслеживать изменения в файловой системе с помощью `inotify` и автоматически передавать измененные файлы на удаленный сервер или другую локальную директорию. `gsync` полезен для администраторов, разработчиков и DevOps-инженеров, которым необходимо синхронизировать данные в режиме реального времени или периодически.

Основные функции утилиты:

- Автоматическая синхронизация файлов и каталогов.
- Поддержка конфигурационных файлов для настройки опций.
- Исключение файлов и каталогов с помощью `.nogsync`, аналогично `.gitignore` в git.
- Запуск в фоновом режиме или в качестве службы для постоянной синхронизации.

## 2. Подробная инструкция по установке зависимостей

`gsync` использует `rsync` и `inotify-tools` для своей работы. Убедитесь, что эти зависимости установлены.

### Ubuntu/Debian

```bash
sudo apt update
sudo apt install rsync inotify-tools
```

### CentOS/RHEL

```bash
sudo yum install epel-release
sudo yum install rsync inotify-tools
```

### Fedora

```bash
sudo dnf install rsync inotify-tools
```

### Arch Linux

```bash
sudo pacman -S rsync inotify-tools
```

## 3. Инструкция по скачиванию утилиты из репозитория

1. Скачайте `gsync` из репозитория GitHub:

```bash
git clone https://github.com/e-bash/gsync.git
cd gsync
```

2. Сделайте скрипт исполняемым:

```bash
chmod +x gsync
```

3. Переместите `gsync` в `/usr/local/bin` или другой путь, чтобы сделать его доступным глобально:

```bash
sudo mv gsync /usr/local/bin/
```

Теперь утилита готова к использованию.

## 4. Подробное описание конфигурационного файла

Конфигурационный файл `gsync` позволяет настроить поведение утилиты. Он должен быть расположен в домашней директории пользователя (`~/.gsync`) или передан через параметр `--config`.

### Пример конфигурационного файла

Файл конфигурации `.gsync`:

```ini
[OPTIONS]
source="/path/to/source/directory/" # Локальная директория для отслеживания
target="user@server:/path/to/target/directory/" # Целевая директория (локальная или удаленная)
links=true # Сохранение символьных ссылок
perms=false # Сохранение прав доступа
times=true # Сохранение времени изменения
group=false # Сохранение групповой принадлежности
owner=false # Сохранение владельца файлов
```

Параметры, которые можно настроить:

- **source**: Путь к локальной директории для отслеживания.
- **target**: Путь к целевой директории (локальной или удаленной).
- **links**: Сохранять ли символьные ссылки (`true`/`false`).
- **perms**: Сохранять ли права доступа (`true`/`false`).
- **times**: Сохранять ли время изменения (`true`/`false`).
- **group**: Сохранять ли групповую принадлежность (`true`/`false`).
- **owner**: Сохранять ли владельца файлов (`true`/`false`).

Пример конфигурационного файла можно найти в репозитории [здесь](https://github.com/e-bash/gsync/blob/main/.gsync).

### Создание конфигурационного файла

Для создания конфигурационного файла скопируйте пример выше и сохраните его в `~/.gsync` или укажите путь к файлу с помощью `--config` при запуске `gsync`.

## 5. Описание возможностей использования `.nogsync`

Файл `.nogsync` работает аналогично файлу `.gitignore` d git и позволяет исключать файлы и директории из отслеживания и синхронизации. Эти файлы могут находиться в корне и на любом уровне вложенности внутри отслеживаемой директории.

### Пример файла `.nogsync`

```bash
# Игнорировать директорию logs и все её содержимое
logs/

# Игнорировать все файлы с расширением .tmp
*.tmp

# Игнорировать конкретный файл
file_to_ignore.txt

# Включить папку important, даже если папка parent игнорируется
!important/

# Игнорировать все файлы внутри temp, кроме temp/keep.txt
temp/*
!temp/keep.txt
```

Пример `.nogsync` можно найти в репозитории [здесь](https://github.com/e-bash/gsync/blob/main/.nogsync).

## 6. Порядок использования

### Разовый запуск из командной строки

Для разового запуска утилиты:

```bash
gsync --config=/path/to/config
```

#### Достоинства:
- Быстрая настройка и запуск.

#### Недостатки:
- Требуется ручной запуск каждый раз.

### Запуск из командной строки в фоновом режиме

Для запуска в фоновом режиме используйте `&`:

```bash
gsync --config=/path/to/config &
```

#### Достоинства:
- Не блокирует терминал.
- Простота использования.

#### Недостатки:
- Требуется контроль за процессом.
- Может завершиться при перезагрузке системы.

### Запуск в качестве службы

Для запуска в качестве службы создайте файл службы systemd:

```bash
sudo nano /etc/systemd/system/gsync.service
```

Добавьте следующее содержимое:

```ini
[Unit]
Description=Gsync Service
After=network.target

[Service]
User=username
ExecStart=/usr/local/bin/gsync --config=/path/to/config
Restart=on-failure

[Install]
WantedBy=multi-user.target
```

Активируйте и запустите службу:

```bash
sudo systemctl enable gsync.service
sudo systemctl start gsync.service
```

#### Достоинства:
- Автоматический запуск при загрузке системы.
- Управление через systemd (перезапуск, логи).

#### Недостатки:
- Требует дополнительных прав для настройки.

### Запуск с помощью Supervisor

1. Установите Supervisor:

   **Ubuntu/Debian:**
   ```bash
   sudo apt install supervisor
   ```

   **CentOS/RHEL:**
   ```bash
   sudo yum install supervisor
   ```

2. Создайте конфигурацию для `gsync` в `/etc/supervisor/conf.d/gsync.conf`:

   ```ini
   [program:gsync]
   command=/usr/local/bin/gsync --config=/path/to/config
   autostart=true
   autorestart=true
   stderr_logfile=/var/log/gsync.err.log
   stdout_logfile=/var/log/gsync.out.log
   ```

3. Примените изменения и запустите `gsync`:

```bash
sudo supervisorctl reread
sudo supervisorctl update
sudo supervisorctl start gsync
```

#### Достоинства:
- Поддержка автоматического перезапуска.
- Управление множеством процессов.

#### Недостатки:
- Необходима установка и настройка Supervisor.

### Какой способ выбрать?

- **Разовый запуск**: Подходит для одноразовых задач или тестирования конфигураций.
- **Фоновый режим**: Подходит для нечастых задач, когда требуется быстрая настройка.
- **Служба systemd**: Идеальный выбор для постоянной синхронизации на сервере.
- **Supervisor**: Хороший выбор для продвинутого управления процессами, если необходимо контролировать несколько сервисов.
